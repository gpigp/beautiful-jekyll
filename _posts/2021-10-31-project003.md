---
layout: post
title: Project003
subtitle: SNP and INDEL calling
cover-img: /assets/post3-img/indel.png
thumbnail-img: https://gpigp.github.io/taehyun/assets/post3-img/marmoset.jpg
tags: [SNP, INDEL, Marmoset, Stanford, GATK4, BWA]

published: true
---

Call SNPs and INDELs
============================

*â• docker í™˜ê²½ì—ì„œ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.*

<h2> 1. Reference & Paired-end whole-genome sequencing data </h2>
<br>
<h6> 2020ë…„ Marmoset Reference </h6>
   
```
wget https://hgdownload.soe.ucsc.edu/goldenPath/calJac4/bigZips/calJac4.fa.gz
gzip -d calJac4.fa.gz
```    
<br>
<h6> SRR7050660(read2) & SRR7050661(read1)</h6>
   
```
wget https://sra-downloadb.be-md.ncbi.nlm.nih.gov/sos2/sra-pub-run-13/SRR7050660/SRR7050660.1
wget https://sra-downloadb.be-md.ncbi.nlm.nih.gov/sos2/sra-pub-run-13/SRR7050661/SRR7050661.1
```   
<br>
<h2> 2. SRA Toolkit ë‹¤ìš´ </h2>
<br>
SRR7050660.1, SRR7050661.1 ê°ê°ì€ ë¶„ë¦¬ì‹œí‚¬ìˆ˜ ìˆëŠ”ë°, SRA Toolkitì´ í•„ìš”í•©ë‹ˆë‹¤.   
[ğŸ‘ˆ](https://github.com/ncbi/sra-tools/wiki/02.-Installing-SRA-Toolkit) <u>ì°¸ì¡°</u>
<br>
<h6> SRA Toolkit íŒŒì¼ ë‹¤ìš´ </h6>
```
wget --output-document sratoolkit.tar.gz http://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/current/sratoolkit.current-ubuntu64.tar.gz
tar -vxzf sratoolkit.tar.gz
```    
<br>
<h6> í™˜ê²½ë³€ìˆ˜ ì„¤ì • </h6>
```
export PATH=$PATH:$PWD/sratoolkit.2.11.2-ubuntu64/bin
which fastq-dump
```
*â• which ì´í›„ ì•„ë¬´ê²ƒë„ ì•ˆëœ¬ë‹¤ë©´ ì„¤ì¹˜ê°€ ì•ˆëœ ê²ƒ.*
<br>
<span style="color: #2D3748; background-color: #fff5b1">2022.04.26.fixed</span>
<br>
   

   #### #fastq-dump -I --split-files íŒŒì¼ì´ë¦„    
   íŒŒì¼ì´ë¦„_1.fastq, íŒŒì¼ì´ë¦„_2.fastqë¡œ ë¶„ë¦¬ëœë‹¤.

   ```
   fastq-dump -I --split-files SRR7050660
   ```
   <br/>
   <br/>

3. 2ê°œì˜ fastqë¥¼ referenceì— ë§¤í•‘ ì‹œí‚¤ê¸°

    * bwa ì„¤ì¹˜    
    ë§¤í•‘ ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” bwaë¥¼ ì„¤ì¹˜í•´ì•¼ í•œë‹¤.    
        https://angus.readthedocs.io/en/2013/bwa-tutorial.html ì´ ë§í¬ì—ì„œ Installing and running bwaë¥¼ ì°¸ê³ í–ˆë‹¤.    
        
        - ë‹¤ìš´ë°›ì„ ê²½ë¡œ    
        ```
        cd /mnt
        ```    
        
        - bwa íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        ```
        curl -L -o bwa-0.7.5.tar.bz2 http://sourceforge.net/projects/bio-bwa/files/bwa-0.7.5a.tar.bz2/download
        ```    
        
        - tar íŒŒì¼ ì••ì¶• í•´ì œ
        ```
        tar xvfj bwa-0.7.5a.tar.bz2
        ```    
        
        - ìœ„ì¹˜ ì´ë™
        ```
        cd bwa-0.7.5a
        ```    
        
        - makeë¥¼ í•˜ë©´ ìë™ ì„¤ì¹˜ê°€ ëœë‹¤
        ```
        make
        ```    
        
        - í™˜ê²½ë³€ìˆ˜ ì„¤ì •
        ```
        cp bwa /usr/local/bin
        ```
        
        - fasta ë° fastqê°€ ìˆëŠ” íŒŒì¼ë¡œ ì´ë™
        ```
        cd home/Lab_Project_003
        ```    
            
    * reference genome ì¸ë±ìŠ¤ ë§Œë“¤ê¸°    
        #### #bwa index íŒŒì¼ì´ë¦„.fa
        ```
        bwa index carJac4.fa
        ```    
    
    * ì‹¤ì œ ë§¤í•‘í•˜ê¸°    
        .faì™€ .fastqë¥¼ ì‹¤ì œ ë§¤í•‘í•˜ëŠ” ë‹¨ê³„ì´ë‹¤.    
        outputìœ¼ë¡œ .sai íŒŒì¼ì´ ìƒì„±ëœë‹¤.    
        #### #bwa aln (ë ˆí¼ëŸ°ìŠ¤)íŒŒì¼ì´ë¦„.fa íŒŒì¼ì´ë¦„_1.fastq > íŒŒì¼ì´ë¦„_1.sai
        ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ cpu ì½”ì–´ í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
        #### #bwa aln -t ì‚¬ìš©í• ì½”ì–´ê°œìˆ˜ -q 15 (ë ˆí¼ëŸ°ìŠ¤)íŒŒì¼ì´ë¦„.fa íŒŒì¼ì´ë¦„_1.fastq > íŒŒì¼ì´ë¦„_1.sai    
        ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ì§€ì •í•œ ì½”ì–´ ê°œìˆ˜ë¡œ ì‚¬ìš©í•˜ê²Œ ë˜ë¯€ë¡œ ì†ë„ê°€ ë¹¨ë¼ì§„ë‹¤.(q -15ëŠ” ì•„ì§ ë¬´ìŠ¨ ì˜ë¯¸ì¸ì§€ ëª¨ë¥´ë‚˜ ì‚¬ìš©í•¨)
        ```
        bwa aln -t 32 -q 15 calJac4.fa SRR7050660_1.fastq > SRR7050660_1.sai    
        bwa aln -t 32 -q 15 calJac4.fa SRR7050660_2.fastq > SRR7050660_2.sai
        ```    
   
    * SAM íŒŒì¼    
        sai íŒŒì¼ì€ ìœ ìš©í•˜ì§€ì•Šë‹¤.    
        ë”°ë¼ì„œ SAM íŒŒì¼ë¡œ ë³€ê²½í•´ì¤€ë‹¤
        #### #bwa sampe (ë ˆí¼ëŸ°ìŠ¤)íŒŒì¼ì´ë¦„.fa íŒŒì¼ì´ë¦„_1.sai íŒŒì¼ì´ë¦„_2.sai íŒŒì¼ì´ë¦„_1.fastq íŒŒì¼ì´ë¦„_2.fastq > íŒŒì¼ì´ë¦„_bwa.sam
        ```
        bwa sampe calJac4.fa SRR7050660_1.sai SRR7050660_2.sai SRR7050660_1.fastq SRR7050660_2.fastq > SRR7050660_bwa.sam
        ```    
        <br/>
        <br/>
        
4. sam íŒŒì¼ì„ bam íŒŒì¼ë¡œ ë³€ê²½í•˜ê¸°

    * Samtool ì„¤ì¹˜
    sam íŒŒì¼ì„ bam íŒŒì¼ë¡œ ë§Œë“¤ë ¤ë©´ samtoolì´ í•„ìš”í•˜ë‹¤.
        ```
        cd /root
        curl -O -L http://sourceforge.net/projects/samtools/files/samtools/0.1.19/samtools-0.1.19.tar.bz2
        tar xvfj samtools-0.1.19.tar.bz2
        cd samtools-0.1.19
        make
        ```    
        
        <span style="color:red">â€» ì˜¤ë¥˜ ë°œìƒ</span>
        ``` c
        bam_tview_curses.c:41:10: fatal error: curses.h: No such file or directory
        #include <curses.h>
                 ^~~~~~~~~~
        compilation terminated.
        Makefile:129: recipe for target 'bam_tview_curses.o' failed
        make: *** [bam_tview_curses.o] Error 1
        ```    
        
        - makeì‹œ ìœ„ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ëœ¬ë‹¤ë©´ libncureses5-devë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
        ```
        apt update && \
        apt install -y \
        libncurses5-dev \
        libncursesw5-dev
        ```    
        
        - ì´í›„ ì•„ë˜ì˜ ê³¼ì •ì€ ë™ì¼í•©ë‹ˆë‹¤.
        ```
        cp samtools /usr/local/bin
        cd misc/
        cp *.pl maq2sam-long maq2sam-short md5fa md5sum-lite wgsim /usr/local/bin/
        ```
        
        - fasta, fastq, sam íŒŒì¼ì´ ìˆëŠ” ê³³ìœ¼ë¡œ ì´ë™
        ```
        cd /home/Lab_Project002
        ```
    * samtool ì‚¬ìš©í•˜ì—¬ bamíŒŒì¼ ë§Œë“¤ê³  ë¶„ë¥˜í•˜ê¸°
    
        - reference genomeì˜ ì¸ë±ìŠ¤ ìƒì„±
        ```
        samtools faidx calJac4.fa
        ```
        
        - sam íŒŒì¼ì„ bam íŒŒì¼ë¡œ ë§Œë“¤ê¸°
        ```
        samtools import calJav4.fa.fai SRR7050660_bwa.sam SRR7050660_bwa.bam
        ```
        
        - bam íŒŒì¼ ë¶„ë¥˜í•˜ê¸°    
        -@ 32ë¥¼ ì‚¬ìš©í•˜ì—¬ multithreading
        ```
        samtools sort -@ 32 SRR7050660_bwa.bam SRR7050660_bwa.sorted
        ```
        
        - ë¶„ë¥˜ëœ bam íŒŒì¼ì˜ ì¸ë±ìŠ¤ ìƒì„±
        ```
        samtools index RAL357_bwa.sorted.bam
        ```

