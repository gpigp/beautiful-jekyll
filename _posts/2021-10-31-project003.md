---
layout: post
title: Project003
subtitle: SNP and INDEL calling
cover-img: /assets/img/path.jpg
<!-- thumbnail-img: https://gpigp.github.io/taehyun/assets/post1-img/project001-cover.png -->
tags: [SNP, INDEL, Marmoset, Stanford, GATK4, BWA]

published: true
---

Call SNPs and INDELs
============================

#### *docker에서 진행된 것입니다*

1. reference와 standard paired-end whole-genome sequencing data 다운

    * reference 다운    
    https://hgdownload.soe.ucsc.edu/goldenPath/calJac4/bigZips/ 2020년 marmoset data

        reference는 calJac4.fa.gz이며 우클릭 하여 링크 주소 복사
        #### #wget 링크주소

         ```
         wget https://hgdownload.soe.ucsc.edu/goldenPath/calJac4/bigZips/calJac4.fa.gz
         ```
         <br/>
    * standard paried-end whole- genome sequencing data 다운    
    https://www.ncbi.nlm.nih.gov/sra/?term=SRP141443 
    
         SRR7050660 다운
    
         ```
         wget https://sra-pub-run-odp.s3.amazonaws.com/sra/SRR7050660/SRR7050660
         ```
         다운 시간은 reference는 얼마 안걸렸지만 SRR7050660은 6시간 정도 걸렸던것 같습니다.  
         <br/>
         <br/>
  

2. 다운 받은 파일 압축 풀기   

    * calJac4.fa.gz 압축 풀기
       
       ```
       gzip -d calJac4.fa.gz
       ```
       calJac4.fa  fasta파일이 생성된다.    
       <br/>

    * SRR7050660 압축 풀기
      
      SRR7050660을 SRA 툴을 사용하여 압축 해제시키면 SRR7050660_1.fastq, SRR7050660_2.fastq로 나뉘어진다.
      https://github.com/ncbi/sra-tools/wiki/02.-Installing-SRA-Toolkit 이 사이트에서 확인 할 수 있다.
      
      먼저 두개 파일로 분리시키기 위해 fastq-dump를 사용해야하는데, SRA Toolkit이 필요합니다.
      #### *각자 환경에 맞게 설치 바랍니다.*
      
      - SRA Toolkit 파일 다운
      
          ```
          wget --output-document sratoolkit.tar.gz http://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/current/sratoolkit.current-ubuntu64.tar.gz
          ```
      
      - 다운받은 tar 압축 풀기
      
          ```
          tar -vxzf sratoolkit.tar.gz
          ```
          
      - 환경변수 설정
      
          ```
          export PATH=$PATH:$PWD/sratoolkit.2.4.0-1.mac64/bin
          ```
      
      - 설치 제대로 됐는지 확인
      
          ```
          which fastq-dump
          ```    
          ###### *아무것도 안뜬다면 설치가 안된 것.*        
        
        
      여기까지가 SRA Toolkit 다운입니다.    
      <br/>
      
      #### #fastq-dump -I --split-files 파일이름    
      파일이름_1.fastq, 파일이름_2.fastq로 분리된다.
      
      ```
      fastq-dump -I --split-files SRR7050660
      ```
      <br/>
      <br/>

3. 2개의 fastq를 reference에 매핑 시키기

    * bwa 설치    
    매핑 시키기 위해서는 bwa를 설치해야 한다.    
        https://angus.readthedocs.io/en/2013/bwa-tutorial.html 이 링크에서 Installing and running bwa를 참고했다.    
        
        - 다운받을 경로    
            ```
            cd /mnt
            ```    
        
        - bwa 파일 다운로드
            ```
            curl -L -o bwa-0.7.5.tar.bz2 http://sourceforge.net/projects/bio-bwa/files/bwa-0.7.5a.tar.bz2/download
            ```    
        
        - tar 파일 압축 해제
            ```
            tar xvfj bwa-0.7.5a.tar.bz2
            ```    
        
        - 위치 이동
            ```
            cd bwa-0.7.5a
            ```
        
        - make를 하면 자동 설치가 된다
            ```
            make
            ```    
        
        - 환경변수 설정
            ```
            cp bwa /usr/local/bin
            ```    
            
        - fasta 및 fastq가 있는 파일로 이동
            ```
            cd home/Lab_Project_003
            ```    
            
    * reference genome 인덱스 만들기    
        #### #bwa index 파일이름.fa
        ```
        bwa index carJac4.fa
        ```    
    
    * 실제 매핑하기    
        .fa와 .fastq를 실제 매핑하는 단계이다.    
        output으로 .sai 파일이 생성된다.    
        #### #bwa aln (레퍼런스)파일이름.fa 파일이름_1.fastq > 파일이름_1.sai
        위의 명령어를 사용하면 cpu 코어 하나만 사용하게 된다.
        #### #bwa aln -t 사용할코어개수 -q 15 (레퍼런스)파일이름.fa 파일이름_1.fastq > 파일이름_1.sai    
        위의 명령어를 사용하면 지정한 코어 개수로 사용하게 되므로 속도가 빨라진다.(q -15는 아직 무슨 의미인지 모르나 사용함)
        ```
        bwa aln -t 32 -q 15 calJac4.fa SRR7050660_1.fastq > SRR7050660_1.sai    
        bwa aln -t 32 -q 15 calJac4.fa SRR7050660_2.fastq > SRR7050660_2.sai
        ```    
   
    * SAM 파일    
        sai 파일은 유용하지않다.    
        따라서 SAM 파일로 변경해준다
        #### #bwa sampe (레퍼런스)파일이름.fa 파일이름_1.sai 파일이름_2.sai 파일이름_1.fastq 파일이름_2.fastq > 파일이름_bwa.sam
        ```
        bwa sampe calJac4.fa SRR7050660_1.sai SRR7050660_2.sai SRR7050660_1.fastq SRR7050660_2.fastq > SRR7050660_bwa.sam
        ```    
        <br/>
        <br/>
        
4. 현재 여기까지 진행중    
